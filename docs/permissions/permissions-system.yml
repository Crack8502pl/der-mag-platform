# ============================================
# System Uprawnie≈Ñ i R√≥l - Der-Mag Platform
# ============================================
# Autor: Copilot + Crack8502pl
# Wersja: 1.1
# Data: 2025-11-15
# Status: DRAFT - po edycji Crack8502pl

metadata:
  title: "System Uprawnie≈Ñ Der-Mag Platform"
  version: "1.1"
  created: "2025-11-15"
  status: "DRAFT"
  description: "Kompleksowy system RBAC z granularnymi uprawnieniami"

# ============================================
# FILOZOFIA SYSTEMU
# ============================================
philosophy:
  multi_role: true  # U≈ºytkownik mo≈ºe mieƒá wiele r√≥l jednocze≈õnie
  admin_auto_access: true  # Admin ma automatycznie wszystkie uprawnienia
  granular_permissions: true  # Uprawnienia typu resource.action
  context_aware: true  # Uprawnienia zale≈ºne od kontekstu (own vs all)
  auditable: true  # Wszystkie akcje sƒÖ logowane
  
  key_principles:
    - "Principle of Least Privilege - minimalne potrzebne uprawnienia"
    - "Separation of Duties - r√≥≈ºne osoby = r√≥≈ºne uprawnienia"
    - "Defense in Depth - wielowarstwowa ochrona"
    - "Audit Everything - pe≈Çna historia dzia≈Ça≈Ñ"

# ============================================
# DEFINICJE R√ìL
# ============================================
roles:
  admin:
    id: 1
    name: "admin"
    display_name: "Administrator"
    description: "Administrator systemu z pe≈Çnym dostƒôpem do wszystkiego"
    is_admin: true  # ‚úÖ Automatycznie wszystkie uprawnienia
    level: 100
    can_have_other_roles: false
    special_abilities:
      - "ZarzƒÖdzanie u≈ºytkownikami i rolami"
      - "Dostƒôp do wszystkich zada≈Ñ"
      - "Usuwanie danych"
      - "Modyfikacja uprawnie≈Ñ"
      - "Dostƒôp do audit log√≥w"
    restrictions: []
    # TODO: Czy admin ma jakie≈õ ograniczenia? Czy mo≈ºe np. usuwaƒá audit logi?
  
  manager:
    id: 2
    name: "manager"
    display_name: "Mened≈ºer Projekt√≥w"
    description: "Mened≈ºer zarzƒÖdzajƒÖcy projektami i zespo≈Çem"
    is_admin: false
    level: 80
    can_have_other_roles: true
    possible_combinations:
      - "manager + technician"  # Mo≈ºe te≈º pracowaƒá w terenie
      - "manager + coordinator"
    special_abilities:
      - "Tworzenie wszystkich typ√≥w zada≈Ñ"
      - "ZarzƒÖdzanie u≈ºytkownikami (tworzenie, edycja)"
      - "Przypisywanie zada≈Ñ"
      - "Zatwierdzanie materia≈Ç√≥w i zdjƒôƒá"
      - "Dostƒôp do raport√≥w i metryk"
    restrictions:
      - "Nie mo≈ºe usuwaƒá u≈ºytkownik√≥w (tylko deaktywacja)"
      - "Nie mo≈ºe zarzƒÖdzaƒá rolami admin"
    # TODO: Czy manager mo≈ºe zmieniƒá uprawnienia innego managera?
  
  coordinator:
    id: 3
    name: "coordinator"
    display_name: "Koordynator"
    description: "Koordynator zada≈Ñ serwisowych"
    is_admin: false
    level: 60
    can_have_other_roles: true
    possible_combinations:
      - "coordinator + technician"
    special_abilities:
      - "Tworzenie zada≈Ñ serwisowych (tylko typ SERWIS)"
      - "Przypisywanie technik√≥w do zada≈Ñ"
      - "Edycja zada≈Ñ serwisowych"
      - "ZarzƒÖdzanie materia≈Çami (BOM)"
    restrictions:
      - "Mo≈ºe tworzyƒá TYLKO zadania typu SERWIS"
      - "Nie mo≈ºe tworzyƒá innych typ√≥w (SMW, CSDIP, SSP, itp.)"
      - "Nie mo≈ºe usuwaƒá zada≈Ñ"
      - "Nie mo≈ºe zarzƒÖdzaƒá u≈ºytkownikami"
    validation:
      # Logika walidacji w kodzie
      task_creation: |
        if (user.role === 'coordinator') {
          const taskType = await getTaskType(taskTypeId);
          if (taskType.code !== 'SERWIS') {
            throw new ForbiddenError('Koordynator mo≈ºe tworzyƒá tylko zadania serwisowe');
          }
        }
    # TODO: Czy coordinator mo≈ºe edytowaƒá zadania innych typ√≥w?
    # TODO: Czy mo≈ºe przeglƒÖdaƒá zadania innych typ√≥w?
  
  technician:
    id: 4
    name: "technician"
    display_name: "Technik"
    description: "Technik terenowy wykonujƒÖcy zadania"
    is_admin: false
    level: 40
    can_have_other_roles: true
    possible_combinations:
      - "technician + coordinator"  # Starszy technik
    special_abilities:
      - "Przejƒôcie dowolnego zadania"  # ‚ö†Ô∏è TWOJE SPECJALNE WYMAGANIE!
      - "Wykonywanie aktywno≈õci w zadaniach"
      - "Upload zdjƒôƒá kontroli jako≈õci"
      - "Rejestracja urzƒÖdze≈Ñ w terenie"
      - "Aktualizacja statusu zada≈Ñ"
    restrictions:
      - "Widzi tylko W≈ÅASNE zadania (assigned to him)"
      - "Mo≈ºe edytowaƒá tylko W≈ÅASNE aktywno≈õci"
      - "NIE MO≈ªE edytowaƒá aktywno≈õci innych technik√≥w"  # ‚ö†Ô∏è KLUCZOWE!
      - "NIE MO≈ªE usuwaƒá aktywno≈õci innych technik√≥w"
      - "Nie mo≈ºe tworzyƒá zada≈Ñ"
      - "Nie mo≈ºe przypisywaƒá innych u≈ºytkownik√≥w"
    special_rules:
      task_takeover:
        description: "Technik mo≈ºe przejƒÖƒá dowolne zadanie"
        process: |
          1. Technik widzi zadanie w statusie 'in_progress'
          2. Klikniƒôcie 'Przejmij zadanie'
          3. System sprawdza:
             - Czy zadanie nie jest zablokowane
             - Czy poprzedni technik nie jest aktywny (ostatnia aktywno≈õƒá > 2h)
          4. Przejƒôcie:
             - Dodaje nowego technika do task_assignments
             - Poprzednie przypisanie pozostaje w historii
             - Status zadania NIE zmienia siƒô
        data_separation: |
          TaskActivity:
            - Ka≈ºda aktywno≈õƒá ma pole 'created_by' (userId)
            - Technik B widzi aktywno≈õci Technika A (readonly)
            - Technik B NIE MO≈ªE edytowaƒá/usunƒÖƒá aktywno≈õci Technika A
            - Technik B dodaje NOWE aktywno≈õci ze swoim userId
          
          QualityPhoto:
            - Ka≈ºde zdjƒôcie ma 'uploaded_by' (userId)
            - Technik B widzi zdjƒôcia Technika A
            - Technik B NIE MO≈ªE usunƒÖƒá zdjƒôƒá Technika A
          
          TaskMaterial:
            - Ka≈ºda alokacja ma 'allocated_by' (userId)
            - Historia alokacji jest zachowana
        validation_code: |
          // Middleware sprawdza:
          if (activity.createdBy !== req.userId && !req.user.isAdmin) {
            throw new ForbiddenError('Nie mo≈ºesz edytowaƒá aktywno≈õci innego technika');
          }
    # TODO: Czy technik widzi wszystkie zadania, czy tylko 'available' + w≈Çasne?
    # TODO: Jak d≈Çugo zadanie jest 'dostƒôpne' do przejƒôcia?
    # TODO: Czy poprzedni technik dostaje powiadomienie?
  
  viewer:
    id: 5
    name: "viewer"
    display_name: "Obserwator"
    description: "Obserwator z dostƒôpem tylko do odczytu"
    is_admin: false
    level: 20
    can_have_other_roles: true
    possible_combinations:
      - "viewer + technician"  # Trainee
    special_abilities:
      - "PrzeglƒÖdanie wszystkich danych"
      - "Eksport raport√≥w (opcjonalnie)"
    restrictions:
      - "TYLKO odczyt - zero modyfikacji"
      - "Nie mo≈ºe niczego dodaƒá/edytowaƒá/usunƒÖƒá"
    # TODO: Czy viewer mo≈ºe eksportowaƒá dane?

# ============================================
# KATALOG UPRAWNIE≈É (63 uprawnienia)
# ============================================
permissions:
  
  # ========================================
  # TASKS (Zadania) - 18 uprawnie≈Ñ
  # ========================================
  tasks:
    - name: "tasks.create.all"
      description: "Tworzenie wszystkich typ√≥w zada≈Ñ"
      resource: "tasks"
      action: "create.all"
      context: null
      examples:
        - "Tworzenie zadania SMW"
        - "Tworzenie zadania CSDIP"
        - "Tworzenie zadania SSP"
    
    - name: "tasks.create.service"
      description: "Tworzenie zada≈Ñ serwisowych (tylko typ SERWIS)"
      resource: "tasks"
      action: "create.service"
      context: "task_type === 'SERWIS'"
      examples:
        - "Naprawa systemu"
        - "Konserwacja systemu"
        - "Naprawa Systemu przed odbiorem ko≈Ñcowym"
        - "Powt√≥rna naprawa w przeciƒÖgu 7 dnii"
      validation: |
        const taskType = await getTaskType(taskTypeId);
        if (taskType.code !== 'SERWIS') {
          throw new ForbiddenError('Mo≈ºesz tworzyƒá tylko zadania serwisowe/reklamacyjne');
        }
    
    - name: "tasks.read"
      description: "Odczyt wszystkich zada≈Ñ"
      resource: "tasks"
      action: "read"
      context: "all"
    
    - name: "tasks.read.own"
      description: "Odczyt tylko w≈Çasnych zada≈Ñ (przypisanych do u≈ºytkownika)"
      resource: "tasks"
      action: "read"
      context: "own"
      query_filter: |
        queryBuilder
          .innerJoin('task.assignments', 'assignment')
          .where('assignment.userId = :userId', { userId: req.userId });
    
    - name: "tasks.update"
      description: "Edycja wszystkich zada≈Ñ"
      resource: "tasks"
      action: "update"
      context: "all"
    
    - name: "tasks.update.own"
      description: "Edycja tylko w≈Çasnych zada≈Ñ"
      resource: "tasks"
      action: "update"
      context: "own"
      validation: |
        const assignment = await getAssignment(taskId, req.userId);
        if (!assignment) {
          throw new ForbiddenError('To nie jest Twoje zadanie');
        }
    
    - name: "tasks.delete"
      description: "Usuwanie zada≈Ñ (soft delete)"
      resource: "tasks"
      action: "delete"
      context: null   
      note: "Soft delete - ustawia active=false"
      
    - name: "tasks.undelete"
      description: "Przywr√≥cenie zadania przypadkowo usuniƒôtego"
      resource: "tasks"
      action: "undelete/reopen"
      context: null
    
    - name: "tasks.assign"
      description: "Przypisywanie u≈ºytkownik√≥w do zada≈Ñ"
      resource: "tasks"
      action: "assign"
      context: null
    
    - name: "tasks.takeover"
      description: "Przejƒôcie zadania (specjalne dla technika)"
      resource: "tasks"
      action: "takeover"
      context: "available_or_assigned_to_inactive"
      special_rule: true
      implementation: |
        // 1. Sprawd≈∫ czy zadanie jest dostƒôpne
        const task = await getTask(taskNumber);
        if (task.status === 'completed') {
          throw new ForbiddenError('Nie mo≈ºesz przejƒÖƒá zako≈Ñczonego zadania');
        }
        
        // 2. Sprawd≈∫ czy zadanie ma status "Save"
        
        // 3. Przejmij
        await addAssignment(task.id, req.userId);
    
    - name: "tasks.status.change"
      description: "Zmiana statusu zadania"
      resource: "tasks"
      action: "status.change"
      context: null
    
    - name: "tasks.priority.change"
      description: "Zmiana priorytetu zadania"
      resource: "tasks"
      action: "priority.change"
      context: null
    
    - name: "tasks.approve"
      description: "Zatwierdzanie zada≈Ñ"
      resource: "tasks"
      action: "approve"
      context: null
      
    - name: "tasks.Save"
      description: "Zapisuje zmiany w zadaniu"
      resource: "tasks"
      action: "Save"
      context: null
    
    - name: "tasks.reject"
      description: "Odrzucanie zada≈Ñ"
      resource: "tasks"
      action: "reject"
      context: null
    
    - name: "tasks.reopen"
      description: "Ponowne otwieranie zamkniƒôtych zada≈Ñ"
      resource: "tasks"
      action: "reopen"
      context: null
      
    - name: "task.unarchive"
      description: "Przywracanie pomy≈Çkowo zarchiwizowanych zada≈Ñ"
      resource: "tasks"
      action: "reopen"
      context: null
    
    - name: "tasks.archive"
      description: "Archiwizowanie zada≈Ñ"
      resource: "tasks"
      action: "archive"
      context: null
  
  # ========================================
  # USERS (U≈ºytkownicy) - 7 uprawnie≈Ñ
  # ========================================
  users:
    - name: "users.create"
      description: "Tworzenie nowych u≈ºytkownik√≥w"
      resource: "users"
      action: "create"
    
    - name: "users.read"
      description: "PrzeglƒÖdanie listy u≈ºytkownik√≥w"
      resource: "users"
      action: "read"
    
    - name: "users.read.own"
      description: "Odczyt tylko w≈Çasnego profilu"
      resource: "users"
      action: "read"
      context: "own"
    
    - name: "users.update"
      description: "Edycja u≈ºytkownik√≥w"
      resource: "users"
      action: "update"
    
    - name: "users.update.own"
      description: "Edycja tylko w≈Çasnego profilu"
      resource: "users"
      action: "update"
      context: "own"
    
    - name: "users.delete"
      description: "Usuwanie u≈ºytkownik√≥w (deaktywacja)"
      resource: "users"
      action: "delete"
      note: "Soft delete - ustawia active=false"
    
    - name: "users.roles.manage"
      description: "Przypisywanie r√≥l u≈ºytkownikom"
      resource: "users"
      action: "roles.manage"
  
  # ========================================
  # BOM (Bill of Materials) - 9 uprawnie≈Ñ
  # ========================================
  bom:
    - name: "bom.read"
      description: "Odczyt materia≈Ç√≥w i szablon√≥w"
      resource: "bom"
      action: "read"
    
    - name: "bom.templates.read"
      description: "Odczyt szablon√≥w BOM"
      resource: "bom"
      action: "templates.read"
    
    - name: "bom.update"
      description: "Edycja materia≈Ç√≥w w zadaniach"
      resource: "bom"
      action: "update"
    
    - name: "bom.templates.create"
      description: "Tworzenie szablon√≥w BOM"
      resource: "bom"
      action: "templates.create"
    
    - name: "bom.templates.update"
      description: "Edycja szablon√≥w BOM"
      resource: "bom"
      action: "templates.update"
    
    - name: "bom.templates.delete"
      description: "Usuwanie szablon√≥w BOM (soft delete)"
      resource: "bom"
      action: "templates.delete"
      
    - name: "bom.templates.purification"
      description: "Usuwanie szablon√≥w BOM proces nieodwracalny 2x potwierdziƒá czynno≈õƒá"
      resource: "bom"
      action: "templates.purification"      
      
    - name: "bom.templates.undelete"
      description: "przywr√≥cenie usuniƒôtego szablon√≥w BOM (soft delete)"
      resource: "bom"
      action: "templates.updelete"        
    
    - name: "bom.approve"
      description: "Zatwierdzanie wykorzystania materia≈Ç√≥w"
      resource: "bom"
      action: "approve"
  
  # ========================================
  # DEVICES (UrzƒÖdzenia) - 6 uprawnie≈Ñ
  # ========================================
  devices:
    - name: "devices.register"
      description: "Rejestracja nowych urzƒÖdze≈Ñ z numerem seryjnym"
      resource: "devices"
      action: "register"
    
    - name: "devices.read"
      description: "Odczyt urzƒÖdze≈Ñ"
      resource: "devices"
      action: "read"
    
    - name: "devices.update"
      description: "Edycja informacji o urzƒÖdzeniach"
      resource: "devices"
      action: "update"
    
    - name: "devices.delete"
      description: "Usuwanie urzƒÖdze≈Ñ (soft delete)"
      resource: "devices"
      action: "delete"
      note: "Soft delete - ustawia active=false"
    
    - name: "devices.verify"
      description: "Weryfikacja urzƒÖdze≈Ñ"
      resource: "devices"
      action: "verify"
    
    - name: "devices.assign"
      description: "Przypisywanie urzƒÖdze≈Ñ do zada≈Ñ"
      resource: "devices"
      action: "assign"
  
  # ========================================
  # ACTIVITIES (Aktywno≈õci/Checklisty) - 6 uprawnie≈Ñ
  # ========================================
  activities:
    - name: "activities.read"
      description: "Odczyt aktywno≈õci i szablon√≥w"
      resource: "activities"
      action: "read"
    
    - name: "activities.read.own"
      description: "Odczyt tylko w≈Çasnych aktywno≈õci"
      resource: "activities"
      action: "read"
      context: "own"
    
    - name: "activities.complete"
      description: "Oznaczanie aktywno≈õci jako wykonane (dodawanie nowego wpisu)"
      resource: "activities"
      action: "complete"
    
    - name: "activities.update.own"
      description: "Edycja tylko w≈Çasnych aktywno≈õci"
      resource: "activities"
      action: "update"
      context: "own"
      validation: |
        const activity = await getActivity(activityId);
        if (activity.createdBy !== req.userId && !req.user.isAdmin) {
          throw new ForbiddenError('Nie mo≈ºesz edytowaƒá aktywno≈õci innego technika');
        }
    
    - name: "activities.update.all"
      description: "Edycja wszystkich aktywno≈õci"
      resource: "activities"
      action: "update"
      context: "all"
    
    - name: "activities.approve"
      description: "Zatwierdzanie wykonanych aktywno≈õci"
      resource: "activities"
      action: "approve"
  
  # ========================================
  # QUALITY (Kontrola jako≈õci) - 7 uprawnie≈Ñ
  # ========================================
  quality:
    - name: "quality.upload"
      description: "Upload zdjƒôƒá kontroli jako≈õci"
      resource: "quality"
      action: "upload"
    
    - name: "quality.read"
      description: "PrzeglƒÖdanie zdjƒôƒá"
      resource: "quality"
      action: "read"
    
    - name: "quality.update"
      description: "Edycja informacji o zdjƒôciach"
      resource: "quality"
      action: "update"
    
    - name: "quality.delete"
      description: "Usuwanie zdjƒôƒá"
      resource: "quality"
      action: "delete"
    
    - name: "quality.approve"
      description: "Zatwierdzanie zdjƒôƒá"
      resource: "quality"
      action: "approve"
    
    - name: "quality.reject"
      description: "Odrzucanie zdjƒôƒá z komentarzem"
      resource: "quality"
      action: "reject"
    
    - name: "quality.require-reupload"
      description: "Wymaganie ponownego uploadu"
      resource: "quality"
      action: "require-reupload"
  
  # ========================================
  # IP MANAGEMENT - 6 uprawnie≈Ñ
  # ========================================
  ip:
    - name: "ip.read"
      description: "PrzeglƒÖdanie pul IP"
      resource: "ip"
      action: "read"
    
    - name: "ip.pools.read"
      description: "Odczyt konfiguracji pul"
      resource: "ip"
      action: "pools.read"
    
    - name: "ip.allocate"
      description: "Alokacja adres√≥w IP z puli"
      resource: "ip"
      action: "allocate"
    
    - name: "ip.release"
      description: "Zwalnianie adres√≥w IP"
      resource: "ip"
      action: "release"
    
    - name: "ip.pools.create"
      description: "Tworzenie nowych pul IP"
      resource: "ip"
      action: "pools.create"
    
    - name: "ip.pools.update"
      description: "Modyfikacja pul IP"
      resource: "ip"
      action: "pools.update"
  
  # ========================================
  # METRICS & REPORTS - 5 uprawnie≈Ñ
  # ========================================
  metrics:
    - name: "metrics.read"
      description: "PrzeglƒÖdanie metryk i dashboardu"
      resource: "metrics"
      action: "read"
    
    - name: "metrics.read.all"
      description: "Dostƒôp do wszystkich statystyk"
      resource: "metrics"
      action: "read.all"
    
    - name: "metrics.export"
      description: "Export raport√≥w do CSV/PDF"
      resource: "metrics"
      action: "export"
    
    - name: "metrics.export.detailed"
      description: "Export szczeg√≥≈Çowych raport√≥w"
      resource: "metrics"
      action: "export.detailed"
    
    - name: "metrics.analytics"
      description: "Dostƒôp do zaawansowanej analityki"
      resource: "metrics"
      action: "analytics"
  
  # ========================================
  # NOTIFICATIONS - 4 uprawnienia
  # ========================================
  notifications:
    - name: "notifications.read"
      description: "Odczyt powiadomie≈Ñ"
      resource: "notifications"
      action: "read"
    
    - name: "notifications.read.all"
      description: "Odczyt wszystkich powiadomie≈Ñ (admin)"
      resource: "notifications"
      action: "read.all"
    
    - name: "notifications.send"
      description: "Wysy≈Çanie powiadomie≈Ñ"
      resource: "notifications"
      action: "send"
    
    - name: "notifications.manage"
      description: "ZarzƒÖdzanie ustawieniami powiadomie≈Ñ"
      resource: "notifications"
      action: "manage"

# ============================================
# MAPOWANIE: Role ‚Üí Permissions
# ============================================
role_permissions_mapping:
  
  admin:
    # Admin ma WSZYSTKO automatycznie (is_admin: true)
    auto_grant: "ALL_PERMISSIONS"
    explicit_permissions: []  # Nie trzeba wypisywaƒá
  
  manager:
    permissions:
      # Tasks - pe≈Çna kontrola
      - "tasks.create.all"
      - "tasks.read"
      - "tasks.update"
      - "tasks.delete"
      - "tasks.assign"
      - "tasks.status.change"
      - "tasks.priority.change"
      - "tasks.approve"
      - "tasks.reject"
      - "tasks.reopen"
      
      # Users - zarzƒÖdzanie
      - "users.read"
      - "users.create"
      - "users.update"
      - "users.roles.manage"  # Mo≈ºe przypisywaƒá role (poza admin)
      
      # BOM - zatwierdzanie
      - "bom.read"
      - "bom.update"
      - "bom.approve"
      - "bom.templates.create"
      - "bom.templates.update"
      
      # Devices
      - "devices.read"
      - "devices.verify"
      - "devices.update"
      
      # Activities
      - "activities.read"
      - "activities.approve"
      
      # Quality - weryfikacja
      - "quality.read"
      - "quality.approve"
      - "quality.reject"
      
      # IP
      - "ip.read"
      - "ip.allocate"
      - "ip.release"
      
      # Metrics - pe≈Çny dostƒôp
      - "metrics.read"
      - "metrics.read.all"
      - "metrics.export"
  
  coordinator:
    permissions:
      # Tasks - tylko serwisowe
      - "tasks.create.service"  # ‚ö†Ô∏è TYLKO SERWIS!
      - "tasks.read"
      - "tasks.update"
      - "tasks.assign"
      - "tasks.status.change"
      
      # Users - odczyt
      - "users.read"
      
      # BOM
      - "bom.read"
      - "bom.update"
      
      # Devices
      - "devices.read"
      - "devices.register"
      
      # Activities
      - "activities.read"
      - "activities.complete"
      
      # Quality
      - "quality.read"
      - "quality.upload"
      
      # IP
      - "ip.read"
      
      # Metrics
      - "metrics.read"
  
  technician:
    permissions:
      # Tasks - tylko swoje + przejƒôcie
      - "tasks.read.own"  # Widzi tylko swoje
      - "tasks.update.own"
      - "tasks.takeover"  # ‚ö†Ô∏è SPECJALNE - mo≈ºe przejƒÖƒá
      - "tasks.status.change"
      
      # BOM
      - "bom.read"
      
      # Devices
      - "devices.read"
      - "devices.register"  # Rejestruje w terenie
      
      # Activities
      - "activities.read"
      - "activities.complete"
      - "activities.update.own"  # ‚ö†Ô∏è Tylko swoje!
      
      # Quality
      - "quality.read"
      - "quality.upload"  # Robi zdjƒôcia
      
      # Metrics
      - "metrics.read"  # Swoje statystyki
  
  viewer:
    permissions:
      # Tylko odczyt
      - "tasks.read"
      - "users.read"
      - "bom.read"
      - "devices.read"
      - "activities.read"
      - "quality.read"
      - "ip.read"
      - "metrics.read"

# ============================================
# SPECJALNE REGU≈ÅY BIZNESOWE
# ============================================
special_rules:
  
  task_takeover_by_technician:
    title: "Przejƒôcie zadania przez technika"
    description: |
      Technik mo≈ºe przejƒÖƒá dowolne zadanie, ale czynno≈õci przez niego odnotowane 
      nie zmieniƒÖ czynno≈õci kt√≥re wykona≈Ç wcze≈õniejszy technik.
    
    step_by_step:
      1:
        step: "Technik widzi zadanie"
        details: |
          - Technik widzi zadania w statusie 'in_progress'
          - Mo≈ºe zobaczyƒá kto jest obecnie przypisany
          - Widzi ostatniƒÖ aktywno≈õƒá (timestamp)
      
      2:
        step: "Klikniƒôcie 'Przejmij zadanie'"
        ui: "Button w widoku szczeg√≥≈Ç√≥w zadania"
      
      3:
        step: "Sprawdzenie przez system"
        checks:
          - "Czy zadanie nie jest w statusie 'completed' lub 'archived'"
          - "Czy poprzedni technik nie jest aktywny (last_activity > 2h)"
          - "Czy zadanie nie jest zablokowane (locked=false)"
        sql: |
          SELECT 
            t.*,
            MAX(ta.created_at) as last_activity
          FROM tasks t
          LEFT JOIN task_activities ta ON t.id = ta.task_id
          WHERE t.task_number = ?
          AND t.status NOT IN ('completed', 'archived')
          AND (
            MAX(ta.created_at) IS NULL 
            OR MAX(ta.created_at) < NOW() - INTERVAL '2 hours'
          )
      
      4:
        step: "Przejƒôcie zadania"
        actions:
          - "Dodanie nowego wpisu do task_assignments"
          - "Poprzednie przypisanie pozostaje (nie jest usuwane)"
          - "Status zadania NIE zmienia siƒô"
          - "Wys≈Çanie powiadomienia do poprzedniego technika (opcjonalnie)"
        sql: |
          -- Nowe przypisanie (nie usuwa starego!)
          INSERT INTO task_assignments (task_id, user_id, assigned_by, role_in_task)
          VALUES (?, ?, NULL, 'technician_takeover');
          
          -- Audit log
          INSERT INTO audit_logs (action, user_id, resource_type, resource_id)
          VALUES ('TASK_TAKEOVER', ?, 'task', ?);
    
    data_separation:
      task_activities:
        description: "Aktywno≈õci sƒÖ osobne dla ka≈ºdego technika"
        schema: |
          CREATE TABLE task_activities (
            id SERIAL PRIMARY KEY,
            task_id INT REFERENCES tasks(id),
            activity_template_id INT,
            created_by INT REFERENCES users(id),  -- ‚ö†Ô∏è KTO STWORZY≈Å
            completed_at TIMESTAMP,
            notes TEXT,
            photos JSONB
          );
        rules:
          - "Ka≈ºda aktywno≈õƒá ma pole 'created_by' wskazujƒÖce technika"
          - "Technik B widzi aktywno≈õci Technika A (SELECT)"
          - "Technik B NIE MO≈ªE UPDATE/DELETE aktywno≈õci Technika A"
          - "Technik B tworzy NOWE wpisy ze swoim user_id"
        validation_code: |
          // Middleware przed UPDATE/DELETE activity
          const activity = await activityRepo.findOne({ where: { id: activityId } });
          
          if (activity.createdBy !== req.userId && !req.user.isAdmin) {
            throw new ForbiddenError({
              message: 'Nie mo≈ºesz modyfikowaƒá aktywno≈õci innego technika',
              code: 'ACTIVITY_NOT_YOURS',
              createdBy: activity.createdBy,
              yourUserId: req.userId
            });
          }
      
      quality_photos:
        description: "Zdjƒôcia sƒÖ osobne dla ka≈ºdego technika"
        rules:
          - "Ka≈ºde zdjƒôcie ma 'uploaded_by'"
          - "Technik B widzi zdjƒôcia Technika A"
          - "Technik B NIE MO≈ªE usunƒÖƒá zdjƒôƒá Technika A"
          - "Admin/Manager mo≈ºe wszystko"
      
      task_materials:
        description: "Alokacje materia≈Ç√≥w sƒÖ audytowane"
        rules:
          - "Ka≈ºda alokacja ma 'allocated_by' i timestamp"
          - "Historia alokacji jest zachowana"
          - "Technik mo≈ºe dodaƒá nowƒÖ alokacjƒô"
          - "Technik nie mo≈ºe zmieniƒá alokacji poprzednika"
    
    ui_considerations:
      task_detail_view: |
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ Zadanie #123456789                     ‚îÇ
        ‚îÇ Status: In Progress                    ‚îÇ
        ‚îÇ                                        ‚îÇ
        ‚îÇ üìã Historia przypisa≈Ñ:                 ‚îÇ
        ‚îÇ ‚Ä¢ Jan Kowalski (2025-11-10 08:00)     ‚îÇ
        ‚îÇ ‚Ä¢ Piotr Nowak (2025-11-12 14:30) ‚Üê TY ‚îÇ
        ‚îÇ                                        ‚îÇ
        ‚îÇ ‚úÖ Aktywno≈õci:                         ‚îÇ
        ‚îÇ [x] Monta≈º kamery                      ‚îÇ
        ‚îÇ     ‚Üí Wykonane przez: Jan Kowalski    ‚îÇ
        ‚îÇ     ‚Üí Data: 2025-11-10 10:00          ‚îÇ
        ‚îÇ     ‚Üí üîí Nie mo≈ºesz edytowaƒá          ‚îÇ
        ‚îÇ                                        ‚îÇ
        ‚îÇ [ ] Konfiguracja rejestratora          ‚îÇ
        ‚îÇ     ‚Üí [Oznacz jako wykonane]          ‚îÇ
        ‚îÇ                                        ‚îÇ
        ‚îÇ üì∏ Zdjƒôcia:                            ‚îÇ
        ‚îÇ ‚Ä¢ foto1.jpg (Jan Kowalski)            ‚îÇ
        ‚îÇ   üîí Nie mo≈ºesz usunƒÖƒá                ‚îÇ
        ‚îÇ ‚Ä¢ [Upload nowego zdjƒôcia]             ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  
  coordinator_service_only:
    title: "Koordynator mo≈ºe tworzyƒá tylko zadania serwisowe"
    validation:
      frontend: |
        // Komponent CreateTask.tsx
        if (user.role === 'coordinator') {
          // Poka≈º tylko typ SERWIS w dropdown
          const taskTypes = allTaskTypes.filter(tt => tt.code === 'SERWIS');
        }
      
      backend: |
        // TaskController.create()
        if (req.user.roles.includes('coordinator') && 
            !req.user.isAdmin && 
            !req.user.roles.includes('manager')) {
          
          const taskType = await getTaskType(taskTypeId);
          
          if (taskType.code !== 'SERWIS') {
            return res.status(403).json({
              success: false,
              message: 'Koordynator mo≈ºe tworzyƒá tylko zadania serwisowe',
              allowedTypes: ['SERWIS'],
              attemptedType: taskType.code
            });
          }
        }
    
    edge_cases:
      - question: "Czy coordinator mo≈ºe EDYTOWAƒÜ zadania innych typ√≥w?"
        answer: "TODO: DO USTALENIA"
        options:
          a: "Tak - mo≈ºe edytowaƒá wszystkie"
          b: "Nie - tylko przeglƒÖdaƒá"
          c: "Tak - tylko swoje (je≈õli by≈Ç assigned)"
      
      - question: "Czy coordinator + manager mo≈ºe tworzyƒá wszystkie typy?"
        answer: "TAK - manager override coordinator restriction"

# ============================================
# USE CASES (Scenariusze)
# ============================================
use_cases:
  
  uc01_task_takeover:
    title: "Technik przejmuje zadanie"
    actors:
      - "Technik A (Jan Kowalski) - poprzedni"
      - "Technik B (Piotr Nowak) - nowy"
      - "System"
    
    preconditions:
      - "Zadanie #123456789 istnieje"
      - "Zadanie ma status 'in_progress'"
      - "Technik A jest assigned, ale nieaktywny >2h"
      - "Technik A wykona≈Ç 3 z 5 aktywno≈õci"
    
    main_flow:
      1: "Technik B loguje siƒô do systemu"
      2: "Technik B przeglƒÖda dostƒôpne zadania"
      3: "Technik B widzi zadanie #123456789 z oznaczeniem 'Dostƒôpne do przejƒôcia'"
      4: "Technik B klika 'Przejmij zadanie'"
      5: "System sprawdza warunki przejƒôcia"
      6: "System dodaje Technika B do task_assignments"
      7: "System pokazuje potwierdzenie"
      8: "Technik B widzi zadanie w 'Moje zadania'"
      9: "Technik B widzi historiƒô aktywno≈õci Technika A (readonly)"
      10: "Technik B kontynuuje od punktu 4/5 checklisty"
    
    postconditions:
      - "Zadanie ma 2 wpisy w task_assignments"
      - "Aktywno≈õci Technika A sƒÖ niezmienione"
      - "Zadanie nadal w statusie 'in_progress'"
      - "Audit log zawiera zdarzenie 'TASK_TAKEOVER'"
    
    alternative_flows:
      a_task_completed:
        condition: "Zadanie jest ju≈º zako≈Ñczone"
        flow:
          - "System pokazuje b≈ÇƒÖd: 'Nie mo≈ºesz przejƒÖƒá zako≈Ñczonego zadania'"
      
      b_technician_active:
        condition: "Technik A jest nadal aktywny (<2h)"
        flow:
          - "System pokazuje: 'Zadanie jest aktywnie realizowane przez Jana Kowalskiego'"
          - "Opcja: 'Wy≈õlij pro≈õbƒô o przekazanie' (TODO: czy to potrzebne?)"
      
      c_task_locked:
        condition: "Zadanie jest zablokowane przez managera"
        flow:
          - "System pokazuje: 'Zadanie jest zablokowane. Skontaktuj siƒô z managerem.'"
  
  uc02_technician_cannot_edit_others_activity:
    title: "Technik pr√≥buje edytowaƒá cudzƒÖ aktywno≈õƒá"
    actors:
      - "Technik B"
      - "System"
    
    preconditions:
      - "Technik B jest assigned do zadania"
      - "Aktywno≈õƒá zosta≈Ça wykonana przez Technika A"
    
    main_flow:
      1: "Technik B otwiera szczeg√≥≈Çy zadania"
      2: "Technik B widzi aktywno≈õƒá wykonanƒÖ przez Technika A"
      3: "Technik B klika 'Edytuj' przy aktywno≈õci Technika A"
      4: "System sprawdza activity.createdBy !== req.userId"
      5: "System zwraca 403 Forbidden"
      6: "Frontend pokazuje: 'Nie mo≈ºesz edytowaƒá aktywno≈õci innego technika'"
    
    validation_code: |
      // Middleware
      export const canModifyActivity = async (req, res, next) => {
        const { activityId } = req.params;
        const activity = await activityRepo.findOne({ where: { id: activityId } });
        
        if (!activity) {
          return res.status(404).json({ message: 'Activity not found' });
        }
        
        // Admin mo≈ºe wszystko
        if (req.user.isAdmin) {
          return next();
        }
        
        // Manager mo≈ºe wszystko
        if (req.user.roles.includes('manager')) {
          return next();
        }
        
        // Technik mo≈ºe tylko swoje
        if (activity.createdBy !== req.userId) {
          return res.status(403).json({
            success: false,
            message: 'Nie mo≈ºesz modyfikowaƒá aktywno≈õci innego technika',
            code: 'ACTIVITY_NOT_YOURS',
            activityCreatedBy: activity.createdBy,
            yourUserId: req.userId
          });
        }
        
        next();
      };
      
      // Route
      router.put('/activities/:activityId', 
        authenticate,
        requirePermissions('activities.update.own', 'activities.update.all'),
        canModifyActivity,  // ‚ö†Ô∏è Dodatkowa walidacja kontekstowa!
        ActivityController.update
      );
  
  uc03_coordinator_creates_service_task:
    title: "Koordynator tworzy zadanie serwisowe"
    actors:
      - "Koordynator"
      - "System"
    
    main_flow:
      1: "Koordynator klika 'Nowe zadanie'"
      2: "System pokazuje formularz"
      3: "W dropdown 'Typ zadania' widzi TYLKO 'Zadanie serwisowe'"
      4: "Koordynator wype≈Çnia formularz"
      5: "Koordynator klika 'Utw√≥rz'"
      6: "System waliduje: taskType.code === 'SERWIS'"
      7: "System tworzy zadanie"
      8: "Koordynator widzi potwierdzenie"
    
    alternative_flow_api_bypass:
      condition: "Koordynator pr√≥buje stworzyƒá SMW przez API (omijajƒÖc frontend)"
      flow:
        1: "Request: POST /api/tasks { taskTypeId: 1 } // SMW"
        2: "Backend sprawdza: user.role === 'coordinator'"
        3: "Backend pobiera: taskType = getTaskType(1)"
        4: "Backend sprawdza: taskType.code !== 'SERWIS'"
        5: "Backend zwraca: 403 Forbidden"
        6: "Response: { message: 'Mo≈ºesz tworzyƒá tylko zadania serwisowe' }"

# ============================================
# IMPLEMENTACJA TECHNICZNA
# ============================================
technical_implementation:
  
  database_schema:
    tables:
      roles:
        sql: |
          CREATE TABLE roles (
            id SERIAL PRIMARY KEY,
            name VARCHAR(50) UNIQUE NOT NULL,
            description TEXT,
            is_admin BOOLEAN DEFAULT FALSE,
            level INT DEFAULT 0,
            active BOOLEAN DEFAULT TRUE,
            created_at TIMESTAMP DEFAULT NOW()
          );
      
      permissions:
        sql: |
          CREATE TABLE permissions (
            id SERIAL PRIMARY KEY,
            name VARCHAR(100) UNIQUE NOT NULL,
            description TEXT,
            resource VARCHAR(50) NOT NULL,
            action VARCHAR(50) NOT NULL,
            context VARCHAR(50),
            created_at TIMESTAMP DEFAULT NOW()
          );
          
          CREATE INDEX idx_permissions_resource ON permissions(resource);
          CREATE INDEX idx_permissions_action ON permissions(action);
      
      role_permissions:
        sql: |
          CREATE TABLE role_permissions (
            role_id INT REFERENCES roles(id) ON DELETE CASCADE,
            permission_id INT REFERENCES permissions(id) ON DELETE CASCADE,
            PRIMARY KEY (role_id, permission_id),
            granted_at TIMESTAMP DEFAULT NOW()
          );
      
      user_roles:
        sql: |
          CREATE TABLE user_roles (
            user_id INT REFERENCES users(id) ON DELETE CASCADE,
            role_id INT REFERENCES roles(id) ON DELETE CASCADE,
            PRIMARY KEY (user_id, role_id),
            assigned_at TIMESTAMP DEFAULT NOW(),
            assigned_by INT REFERENCES users(id)
          );
          
          CREATE INDEX idx_user_roles_user ON user_roles(user_id);
          CREATE INDEX idx_user_roles_role ON user_roles(role_id);
      
      task_activities:
        note: "Dodaj kolumnƒô created_by dla ≈õledzenia autora"
        sql: |
          ALTER TABLE task_activities 
          ADD COLUMN created_by INT REFERENCES users(id);
          
          CREATE INDEX idx_task_activities_created_by ON task_activities(created_by);
      
      quality_photos:
        note: "Dodaj kolumnƒô uploaded_by"
        sql: |
          ALTER TABLE quality_photos 
          ADD COLUMN uploaded_by INT REFERENCES users(id);
  
  middleware:
    authenticate:
      code: |
        export const authenticate = async (req, res, next) => {
          const token = req.headers.authorization?.split(' ')[1];
          const decoded = jwt.verify(token, JWT_SECRET);
          
          // Pobierz user z rolami i uprawnieniami
          const user = await userRepo.findOne({
            where: { id: decoded.userId },
            relations: ['roles', 'roles.permissions']
          });
          
          // Zbierz uprawnienia
          const permissions = new Set<string>();
          let isAdmin = false;
          
          for (const role of user.roles) {
            if (role.isAdmin) {
              isAdmin = true;
              break;
            }
            role.permissions.forEach(p => permissions.add(p.name));
          }
          
          req.user = {
            ...decoded,
            roles: user.roles.map(r => r.name),
            permissions: Array.from(permissions),
            isAdmin
          };
          
          next();
        };
    
    requirePermissions:
      code: |
        export const requirePermissions = (...requiredPerms: string[]) => {
          return async (req, res, next) => {
            // Admin ma wszystko
            if (req.user.isAdmin) {
              return next();
            }
            
            // Sprawd≈∫ czy user ma wszystkie wymagane uprawnienia
            const hasAll = requiredPerms.every(p => 
              req.user.permissions.includes(p)
            );
            
            if (!hasAll) {
              return res.status(403).json({
                success: false,
                message: 'Brak uprawnie≈Ñ',
                required: requiredPerms,
                current: req.user.permissions
              });
            }
            
            next();
          };
        };
    
    requireAnyPermission:
      code: |
        export const requireAnyPermission = (...requiredPerms: string[]) => {
          return async (req, res, next) => {
            if (req.user.isAdmin) {
              return next();
            }
            
            const hasAny = requiredPerms.some(p => 
              req.user.permissions.includes(p)
            );
            
            if (!hasAny) {
              return res.status(403).json({
                success: false,
                message: 'Brak uprawnie≈Ñ'
              });
            }
            
            next();
          };
        };
  
  usage_examples:
    routes:
      code: |
        // Tasks routes
        router.get('/tasks', 
          authenticate,
          requireAnyPermission('tasks.read', 'tasks.read.own'),
          TaskController.list
        );
        
        router.post('/tasks',
          authenticate,
          requirePermissions('tasks.create.all', 'tasks.create.service'),
          TaskController.create
        );
        
        router.put('/tasks/:id',
          authenticate,
          requireAnyPermission('tasks.update', 'tasks.update.own'),
          TaskController.update
        );
        
        router.delete('/tasks/:id',
          authenticate,
          requirePermissions('tasks.delete'),
          TaskController.delete
        );
        
        // Activities routes
        router.put('/activities/:id',
          authenticate,
          requireAnyPermission('activities.update.own', 'activities.update.all'),
          canModifyActivity,  // Extra check!
          ActivityController.update
        );

# ============================================
# PYTANIA DO USTALENIA
# ============================================
questions_to_resolve:
  - id: Q1
    question: "Czy technik widzi WSZYSTKIE zadania, czy tylko dostƒôpne + w≈Çasne?"
    options:
      a: "Wszystkie (transparency)"
      b: "Tylko available + assigned to him (isolation)"
      c: "Konfigurowalny per deployment"
    recommendation: "Opcja B - isolation"
  
  - id: Q2
    question: "Jak d≈Çugo zadanie jest 'dostƒôpne do przejƒôcia'?"
    options:
      a: "Je≈õli last_activity > 2h"
      b: "Je≈õli last_activity > 4h"
      c: "Manualnie oznaczone przez managera"
    recommendation: "Opcja A - 2h jako default, C jako override"
  
  - id: Q3
    question: "Czy coordinator mo≈ºe edytowaƒá zadania innych typ√≥w (nie-SERWIS)?"
    options:
      a: "Nie mo≈ºe wcale"
      b: "Mo≈ºe tylko je≈õli jest assigned"
      c: "Mo≈ºe tylko status change"
    recommendation: "Opcja B"
  
  - id: Q4
    question: "Czy poprzedni technik dostaje powiadomienie o przejƒôciu?"
    options:
      a: "Tak, zawsze"
      b: "Nie"
      c: "Opcjonalnie (ustawienie)"
    recommendation: "Opcja A - dla transparency"
  
  - id: Q5
    question: "Czy viewer mo≈ºe eksportowaƒá raporty?"
    options:
      a: "Tak"
      b: "Nie"
      c: "Tylko swoje statystyki"
    recommendation: "Opcja A - helpful for auditors"
  
  - id: Q6
    question: "Czy admin mo≈ºe usuwaƒá audit logi?"
    options:
      a: "Nie - immutable zawsze"
      b: "Tak - tylko admin"
      c: "Tak - tylko starsze ni≈º X dni"
    recommendation: "Opcja A - compliance requirement"

# ============================================
# PRIORYTETY IMPLEMENTACJI
# ============================================
implementation_priorities:
  
  phase_1_must_have:
    priority: "CRITICAL"
    duration: "2 weeks"
    items:
      - "Nowy system r√≥l i uprawnie≈Ñ (tabele DB)"
      - "Middleware: requirePermissions, requireAnyPermission"
      - "Migracja istniejƒÖcych u≈ºytkownik√≥w"
      - "Task takeover mechanism dla technika"
      - "Walidacja activities.update.own"
      - "Coordinator service-only validation"
  
  phase_2_should_have:
    priority: "HIGH"
    duration: "1 week"
    items:
      - "Audit logging wszystkich akcji"
      - "Token rotation system"
      - "Activity ownership UI indicators"
      - "Task takeover notifications"
      - "Admin panel do zarzƒÖdzania rolami"
  
  phase_3_nice_to_have:
    priority: "MEDIUM"
    duration: "1 week"
    items:
      - "Dynamic permission system (bez migracji)"
      - "Permission groups dla ≈Çatwiejszego zarzƒÖdzania"
      - "Role templates (presets)"
      - "Time-based permissions (temporary access)"
      - "Geofencing dla technik√≥w (GPS-based permissions)"

# ============================================
# NOTATKI I UWAGI
# ============================================
notes:
  security_considerations:
    - "‚ö†Ô∏è NIGDY nie sprawdzaj uprawnie≈Ñ tylko na frontend!"
    - "‚úÖ ZAWSZE waliduj backend + middleware"
    - "‚úÖ Admin bypass WSZYSTKO automatycznie"
    - "‚ö†Ô∏è Kontekstowe sprawdzanie (own vs all) w service layer"
    - "‚úÖ Audit KA≈ªDƒÑ akcjƒô modyfikujƒÖcƒÖ dane"
  
  performance_tips:
    - "Cache permissions per user (Redis, 5 min TTL)"
    - "Nie ≈Çaduj permissions na ka≈ºdy request (JWT zawiera permissions)"
    - "Index na user_roles, role_permissions"
    - "Partycjonuj audit_logs po dacie"
  
  testing_checklist:
    - "[ ] Admin mo≈ºe wszystko"
    - "[ ] Manager nie mo≈ºe usuwaƒá admin√≥w"
    - "[ ] Coordinator nie mo≈ºe tworzyƒá SMW"
    - "[ ] Technician nie mo≈ºe edytowaƒá cudzych activities"
    - "[ ] Technician mo≈ºe przejƒÖƒá zadanie"
    - "[ ] Viewer nie mo≈ºe niczego zmieniƒá"
    - "[ ] Multi-role dzia≈Ça (manager + technician)"
  
  migration_from_old_system:
    - "Stary system: users.role_id (jeden)"
    - "Nowy system: user_roles (many-to-many)"
    - "Migration: INSERT INTO user_roles (user_id, role_id) SELECT id, role_id FROM users"
    - "Backward compatibility: zachowaj stary authorize() jako deprecated"

# ============================================
# CHANGELOG
# ============================================
changelog:
  - version: "1.0"
    date: "2025-11-15"
    changes:
      - "Pierwsza wersja propozycji"
      - "Definicja 5 r√≥l"
      - "Katalog 63 uprawnie≈Ñ"
      - "Specjalne regu≈Çy dla technika (task takeover)"
      - "Use cases i scenariusze"
      - "Implementacja techniczna"

# ============================================
# KO≈ÉCOWE TODO DLA U≈ªYTKOWNIKA
# ============================================
user_todos:
  - "[ ] Przejrzyj wszystkie uprawnienia - czy wszystkie sƒÖ potrzebne?"
  - "[ ] Odpowiedz na pytania w sekcji 'questions_to_resolve'"
  - "[ ] Doprecyzuj regu≈Çy task takeover (co dok≈Çadnie ma siƒô dziaƒá)"
  - "[ ] Zdecyduj czy coordinator mo≈ºe edytowaƒá zadania innych typ√≥w"
  - "[ ] Dodaj swoje specjalne regu≈Çy je≈õli sƒÖ"
  - "[ ] Review use cases - czy pokrywajƒÖ wszystkie scenariusze?"
  - "[ ] Zatwierd≈∫ lub zmodyfikuj propozycjƒô"
  - "[ ] Prze≈õlij z powrotem do implementacji!"
